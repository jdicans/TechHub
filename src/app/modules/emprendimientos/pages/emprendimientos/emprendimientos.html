<div class="emprendimientos-container">
  <!-- Header Section -->
  <header class="header">
    <div class="header-content">
      <h1 class="title">Emprendimientos</h1>
      <p class="subtitle">Descubre proyectos innovadores de la comunidad</p>
      <button class="btn-crear" (click)="toggleFormulario()">
        <lucide-icon name="plus"></lucide-icon>
        Crear Emprendimiento
      </button>
    </div>
  </header>

  <!-- Creation Form -->
  @if (mostrarFormulario) {
    <div class="formulario-emprendimiento">
      <div class="formulario-header">
        <h2>{{ emprendimientoEditando ? 'Editar' : 'Nuevo' }} Emprendimiento</h2>
      </div>
      <form (ngSubmit)="emprendimientoEditando ? actualizarEmprendimiento() : crearEmprendimiento()">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre del Emprendimiento *</label>
            <input
              type="text"
              id="nombre"
              [(ngModel)]="nuevoEmprendimiento.nombre"
              name="nombre"
              required
              placeholder="Ingrese el nombre del emprendimiento"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="descripcion">Descripción *</label>
            <textarea
              id="descripcion"
              [(ngModel)]="nuevoEmprendimiento.descripcion"
              name="descripcion"
              required
              rows="4"
              placeholder="Describa su emprendimiento, qué problema resuelve y su propuesta de valor"
            ></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="lugar">Ubicación</label>
            <input
              type="text"
              id="lugar"
              [(ngModel)]="nuevoEmprendimiento.lugar"
              name="lugar"
              placeholder="Ciudad o ubicación del emprendimiento"
            />
          </div>

          <div class="form-group">
            <label for="modalidad">Modalidad</label>
            <select
              id="modalidad"
              [(ngModel)]="nuevoEmprendimiento.modalidad"
              name="modalidad"
            >
              <option value="">Seleccione una modalidad</option>
              <option value="Presencial">Presencial</option>
              <option value="Virtual">Virtual</option>
              <option value="Híbrido">Híbrido</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="cancelarFormulario()">
            Cancelar
          </button>
          <button type="submit" class="btn-submit">
            {{ emprendimientoEditando ? 'Actualizar' : 'Crear' }} Emprendimiento
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Filters Section -->
  <section class="filtros">
    <div class="filtros-content">
      <div class="filtros-row">
        <div class="filtro-group">
          <label for="busqueda">Buscar</label>
          <input
            type="text"
            id="busqueda"
            [(ngModel)]="filtros.busqueda"
            (ngModelChange)="aplicarFiltros()"
            placeholder="Buscar emprendimientos..."
          />
        </div>

        <div class="filtro-group">
          <label for="filtroModalidad">Modalidad</label>
          <select
            id="filtroModalidad"
            [(ngModel)]="filtros.modalidad"
            (ngModelChange)="aplicarFiltros()"
          >
            <option value="">Todas las modalidades</option>
            <option value="Presencial">Presencial</option>
            <option value="Virtual">Virtual</option>
            <option value="Híbrido">Híbrido</option>
          </select>
        </div>

        <div class="filtro-group">
          <label for="ordenarPor">Ordenar por</label>
          <select
            id="ordenarPor"
            [(ngModel)]="filtros.ordenarPor"
            (ngModelChange)="aplicarFiltros()"
          >
            <option value="recientes">Más recientes</option>
            <option value="antiguos">Más antiguos</option>
            <option value="nombre">Nombre (A-Z)</option>
          </select>
        </div>

        <button class="btn-limpiar" (click)="limpiarFiltros()">
          <lucide-icon name="x"></lucide-icon>
          Limpiar Filtros
        </button>
      </div>
    </div>
  </section>

  <!-- Emprendimientos Grid -->
  @if (cargando) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando emprendimientos...</p>
    </div>
  } @else if (emprendimientosPaginados.length > 0) {
    <div class="emprendimientos-grid">
      @for (emprendimiento of emprendimientosPaginados; track emprendimiento.id_evento) {
        <article class="emprendimiento-card" (click)="verDetalle(emprendimiento)">
          <div class="card-header">
            <div class="card-badge-container">
              @if (emprendimiento.modalidad) {
                <span class="badge-modalidad" [class.presencial]="emprendimiento.modalidad === 'Presencial'" 
                                               [class.virtual]="emprendimiento.modalidad === 'Virtual'"
                                               [class.hibrido]="emprendimiento.modalidad === 'Híbrido'">
                  <lucide-icon name="monitor"></lucide-icon>
                  {{ emprendimiento.modalidad }}
                </span>
              }
            </div>
            @if (emprendimiento.id_usuario === usuarioActualId) {
              <div class="card-actions-header">
                <button class="btn-icon btn-editar" (click)="editarEmprendimiento(emprendimiento); $event.stopPropagation()" title="Editar">
                  <lucide-icon name="edit"></lucide-icon>
                </button>
                <button class="btn-icon btn-eliminar" (click)="eliminarEmprendimiento(emprendimiento.id_evento!); $event.stopPropagation()" title="Eliminar">
                  <lucide-icon name="trash-2"></lucide-icon>
                </button>
              </div>
            }
          </div>

          <div class="card-body">
            <h3 class="card-title">{{ emprendimiento.nombre }}</h3>
            <p class="card-descripcion">{{ emprendimiento.descripcion }}</p>

            @if (emprendimiento.lugar) {
              <div class="card-location">
                <lucide-icon name="map-pin"></lucide-icon>
                <span>{{ emprendimiento.lugar }}</span>
              </div>
            }
          </div>

          <div class="card-footer">
            @if (emprendimiento.organizador) {
              <div class="card-creator">
                @if (emprendimiento.organizador.foto_perfil) {
                  <img
                    class="creator-avatar"
                    [src]="emprendimiento.organizador.foto_perfil"
                    [alt]="emprendimiento.organizador.nombre"
                  />
                } @else {
                  <div class="creator-avatar-placeholder">
                    {{ emprendimiento.organizador.nombre.charAt(0) || 'U' }}
                  </div>
                }
                <span class="creator-nombre">{{ emprendimiento.organizador.nombre }} {{ emprendimiento.organizador.apellido }}</span>
              </div>
            }

            <button class="btn-ver-mas" (click)="verDetalle(emprendimiento); $event.stopPropagation()">
              <lucide-icon name="arrow-right"></lucide-icon>
            </button>
          </div>
        </article>
      }
    </div>

    <!-- Paginación -->
    <app-pagination
      [currentPage]="paginaActual"
      [totalItems]="totalItems"
      [itemsPerPage]="itemsPorPagina"
      [maxVisiblePages]="5"
      (pageChange)="onPaginaChange($event)"
    ></app-pagination>
  } @else {
    <div class="empty-state">
      <div class="empty-icon">
        <lucide-icon name="lightbulb"></lucide-icon>
      </div>
      <h3>No hay emprendimientos disponibles</h3>
      <p class="empty-state-subtitle">Sé el primero en compartir tu idea innovadora con la comunidad</p>
      <button class="btn-crear-empty" (click)="toggleFormulario()">
        <lucide-icon name="plus"></lucide-icon>
        Crear Primer Emprendimiento
      </button>
    </div>
  }

  <!-- Detail Modal -->
  @if (emprendimientoSeleccionado) {
    <div class="overlay" (click)="cerrarDetalle()">
      <div class="modal-detalle" (click)="$event.stopPropagation()">
        <button class="btn-cerrar" (click)="cerrarDetalle()">
          <lucide-icon name="x"></lucide-icon>
        </button>

        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title">{{ emprendimientoSeleccionado.nombre }}</h2>
            @if (emprendimientoSeleccionado.modalidad) {
              <span class="badge-modalidad" 
                    [class.presencial]="emprendimientoSeleccionado.modalidad === 'Presencial'"
                    [class.virtual]="emprendimientoSeleccionado.modalidad === 'Virtual'"
                    [class.hibrido]="emprendimientoSeleccionado.modalidad === 'Híbrido'">
                <lucide-icon name="monitor"></lucide-icon>
                {{ emprendimientoSeleccionado.modalidad }}
              </span>
            }
          </div>

          <div class="modal-body">
            <section class="detalle-section">
              <h3>Descripción</h3>
              <p>{{ emprendimientoSeleccionado.descripcion }}</p>
            </section>

            @if (emprendimientoSeleccionado.lugar || emprendimientoSeleccionado.modalidad) {
              <section class="detalle-section">
                <h3>Información del Emprendimiento</h3>
                <div class="evento-info">
                  @if (emprendimientoSeleccionado.lugar) {
                    <div class="info-item">
                      <lucide-icon name="map-pin"></lucide-icon>
                      <div>
                        <span class="info-label">Ubicación:</span>
                        <span class="info-value">{{ emprendimientoSeleccionado.lugar }}</span>
                      </div>
                    </div>
                  }
                  @if (emprendimientoSeleccionado.modalidad) {
                    <div class="info-item">
                      <lucide-icon name="monitor"></lucide-icon>
                      <div>
                        <span class="info-label">Modalidad:</span>
                        <span class="info-value">{{ emprendimientoSeleccionado.modalidad }}</span>
                      </div>
                    </div>
                  }
                </div>
              </section>
            }

            @if (emprendimientoSeleccionado.organizador) {
              <section class="detalle-section">
                <h3>Organizador</h3>
                <div class="organizador-info">
                  @if (emprendimientoSeleccionado.organizador.foto_perfil) {
                    <img
                      class="organizador-avatar"
                      [src]="emprendimientoSeleccionado.organizador.foto_perfil"
                      [alt]="emprendimientoSeleccionado.organizador.nombre"
                    />
                  } @else {
                    <div class="organizador-avatar-placeholder">
                      {{ emprendimientoSeleccionado.organizador.nombre.charAt(0) }}
                    </div>
                  }
                  <div class="organizador-details">
                    <span class="organizador-nombre">{{ emprendimientoSeleccionado.organizador.nombre }} {{ emprendimientoSeleccionado.organizador.apellido }}</span>
                  </div>
                </div>
              </section>
            }
          </div>

          <div class="modal-footer">
            @if (emprendimientoSeleccionado.id_usuario === usuarioActualId) {
              <button class="btn-editar-modal" (click)="editarEmprendimiento(emprendimientoSeleccionado); cerrarDetalle()">
                <lucide-icon name="edit"></lucide-icon>
                Editar Emprendimiento
              </button>
              <button class="btn-eliminar-modal" (click)="eliminarEmprendimiento(emprendimientoSeleccionado.id_evento!); cerrarDetalle()">
                <lucide-icon name="trash-2"></lucide-icon>
                Eliminar
              </button>
            }
            <button class="btn-cerrar-modal" (click)="cerrarDetalle()">
              <lucide-icon name="x"></lucide-icon>
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
