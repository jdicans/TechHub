<div class="dashboard-container">
  <!-- Loading State -->
  @if (cargando) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando dashboard...</p>
    </div>
  }

  @if (!cargando) {
    <!-- Header Section -->
    <header class="header">
      <div class="header-content">
        <h1 class="title">Dashboard</h1>
        <p class="subtitle">¡Bienvenido {{ usuarioActual?.nombre || 'de nuevo' }}! Aquí tienes un resumen de tu actividad en TechHub</p>
      </div>
    </header>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <!-- Publicaciones -->
      <a [routerLink]="['/blog']" class="stat-card stat-card-publicaciones">
        <div class="stat-icon">
          <lucide-icon name="book-open"></lucide-icon>
        </div>
        <div class="stat-info">
          <h3>{{ stats.totalPublicaciones }}</h3>
          <p class="stat-label">Publicaciones</p>
          <span class="stat-detail">{{ stats.misPublicaciones }} tuyas</span>
        </div>
      </a>

      <!-- Grupos -->
      <a [routerLink]="['/grupos']" class="stat-card stat-card-grupos">
        <div class="stat-icon">
          <lucide-icon name="users"></lucide-icon>
        </div>
        <div class="stat-info">
          <h3>{{ stats.totalGrupos }}</h3>
          <p class="stat-label">Grupos de Estudio</p>
          <span class="stat-detail">{{ stats.misGrupos }} tuyos</span>
        </div>
      </a>

      <!-- Eventos -->
      <a [routerLink]="['/eventos']" class="stat-card stat-card-eventos">
        <div class="stat-icon">
          <lucide-icon name="calendar"></lucide-icon>
        </div>
        <div class="stat-info">
          <h3>{{ stats.totalEventos }}</h3>
          <p class="stat-label">Eventos</p>
          <span class="stat-detail">{{ stats.eventosInscritos }} inscritos</span>
        </div>
      </a>

      <!-- Emprendimientos -->
      <a [routerLink]="['/emprendimientos']" class="stat-card stat-card-emprendimientos">
        <div class="stat-icon">
          <lucide-icon name="briefcase"></lucide-icon>
        </div>
        <div class="stat-info">
          <h3>{{ stats.totalEmprendimientos }}</h3>
          <p class="stat-label">Emprendimientos</p>
          <span class="stat-detail">{{ stats.misEmprendimientos }} tuyos</span>
        </div>
      </a>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Column 1: Eventos Próximos -->
      <div class="content-section">
        <div class="section-header">
          <h2>
            <lucide-icon name="calendar"></lucide-icon>
            Próximos Eventos
          </h2>
          <a [routerLink]="['/eventos']" class="btn-link">Ver todos</a>
        </div>

        @if (eventosProximos.length > 0) {
          <div class="eventos-list">
            @for (evento of eventosProximos; track evento.id_evento) {
              <a [routerLink]="['/eventos']" class="evento-card">
                <div class="evento-header">
                  <h3>{{ evento.nombre }}</h3>
                  <span class="evento-dias">
                    @if (getDiasHastaEvento(evento.fecha_evento) === 0) {
                      Hoy
                    } @else if (getDiasHastaEvento(evento.fecha_evento) === 1) {
                      Mañana
                    } @else {
                      {{ getDiasHastaEvento(evento.fecha_evento) }} días
                    }
                  </span>
                </div>
                <p class="evento-fecha">
                  <lucide-icon name="calendar"></lucide-icon>
                  {{ formatearFechaCompleta(evento.fecha_evento) }}
                </p>
                @if (evento.total_inscritos) {
                  <p class="evento-inscritos">
                    <lucide-icon name="users"></lucide-icon>
                    {{ evento.total_inscritos }} inscritos
                  </p>
                }
              </a>
            }
          </div>
        } @else {
          <div class="empty-state">
            <lucide-icon name="calendar"></lucide-icon>
            <p>No hay eventos próximos</p>
            <a [routerLink]="['/eventos']" class="btn-primary">Explorar eventos</a>
          </div>
        }
      </div>

      <!-- Column 2: Publicaciones Recientes -->
      <div class="content-section">
        <div class="section-header">
          <h2>
            <lucide-icon name="book-open"></lucide-icon>
            Publicaciones Recientes
          </h2>
          <a [routerLink]="['/blog']" class="btn-link">Ver todas</a>
        </div>

        @if (publicacionesRecientes.length > 0) {
          <div class="publicaciones-list">
            @for (post of publicacionesRecientes; track post.id_publicacion) {
              <a [routerLink]="['/blog']" class="publicacion-card">
                <h3>{{ getTruncatedText(post.titulo, 50) }}</h3>
                <p class="publicacion-contenido">
                  {{ getTruncatedText(post.contenido, 100) }}
                </p>
                <div class="publicacion-meta">
                  <span class="publicacion-autor">
                    <lucide-icon name="user"></lucide-icon>
                    {{ post.usuario?.nombre || 'Usuario' }} {{ post.usuario?.apellido || '' }}
                  </span>
                  <span class="publicacion-fecha">{{ formatearFecha(post.fecha_creacion) }}</span>
                </div>
              </a>
            }
          </div>
        } @else {
          <div class="empty-state">
            <lucide-icon name="book-open"></lucide-icon>
            <p>No hay publicaciones recientes</p>
            <a [routerLink]="['/blog']" class="btn-primary">Crear publicación</a>
          </div>
        }
      </div>
    </div>

    <!-- Second Row -->
    <div class="content-grid">
      <!-- Grupos Destacados -->
      <div class="content-section">
        <div class="section-header">
          <h2>
            <lucide-icon name="users"></lucide-icon>
            Grupos de Estudio
          </h2>
          <a [routerLink]="['/grupos']" class="btn-link">Ver todos</a>
        </div>

        @if (gruposDestacados.length > 0) {
          <div class="grupos-list">
            @for (grupo of gruposDestacados; track grupo.id_grupo) {
              <a [routerLink]="['/grupos']" class="grupo-card">
                <div class="grupo-header">
                  <h3>{{ grupo.nombre }}</h3>
                  @if (grupo.privado) {
                    <span class="badge badge-privado">
                      <lucide-icon name="lock"></lucide-icon>
                      Privado
                    </span>
                  } @else {
                    <span class="badge badge-publico">
                      <lucide-icon name="globe"></lucide-icon>
                      Público
                    </span>
                  }
                </div>
                <p class="grupo-descripcion">{{ getTruncatedText(grupo.descripcion, 80) }}</p>
                <div class="grupo-meta">
                  <span>
                    <lucide-icon name="users"></lucide-icon>
                    {{ grupo.miembros?.length || 0 }} miembros
                  </span>
                  <span>{{ formatearFecha(grupo.fecha_creacion) }}</span>
                </div>
              </a>
            }
          </div>
        } @else {
          <div class="empty-state">
            <lucide-icon name="users"></lucide-icon>
            <p>No hay grupos disponibles</p>
            <a [routerLink]="['/grupos']" class="btn-primary">Crear grupo</a>
          </div>
        }
      </div>

      <!-- Emprendimientos Recientes -->
      <div class="content-section">
        <div class="section-header">
          <h2>
            <lucide-icon name="briefcase"></lucide-icon>
            Emprendimientos
          </h2>
          <a [routerLink]="['/emprendimientos']" class="btn-link">Ver todos</a>
        </div>

        @if (emprendimientosRecientes.length > 0) {
          <div class="emprendimientos-list">
            @for (emprendimiento of emprendimientosRecientes; track emprendimiento.id_evento) {
              <a [routerLink]="['/emprendimientos']" class="emprendimiento-card">
                <h3>{{ emprendimiento.nombre }}</h3>
                <p class="emprendimiento-descripcion">
                  {{ getTruncatedText(emprendimiento.descripcion, 100) }}
                </p>
                <div class="emprendimiento-meta">
                  <span>
                    <lucide-icon name="calendar"></lucide-icon>
                    {{ formatearFecha(emprendimiento.fecha_evento) }}
                  </span>
                  @if (emprendimiento.total_inscritos) {
                    <span>
                      <lucide-icon name="users"></lucide-icon>
                      {{ emprendimiento.total_inscritos }} interesados
                    </span>
                  }
                </div>
              </a>
            }
          </div>
        } @else {
          <div class="empty-state">
            <lucide-icon name="briefcase"></lucide-icon>
            <p>No hay emprendimientos disponibles</p>
            <a [routerLink]="['/emprendimientos']" class="btn-primary">Crear emprendimiento</a>
          </div>
        }
      </div>
    </div>
  }
</div>
