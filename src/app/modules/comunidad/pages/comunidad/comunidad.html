<div class="comunidad-container">
  @if (cargando) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando miembros...</p>
    </div>
  } @else {
    <!-- Header Section -->
    <header class="comunidad-header">
      <div class="header-content">
        <h1 class="title">Comunidad TechHub</h1>
        <p class="subtitle">Conecta con {{ miembros.length }} profesionales y entusiastas de la tecnología</p>
        <div class="header-stats">
          <div class="stat-item">
            <lucide-icon name="users"></lucide-icon>
            <span>{{ miembros.length }} Miembros</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Buscador y Filtros -->
    <div class="filtros-section">
      <div class="filtros-container">
        <div class="search-box">
          <lucide-icon name="search"></lucide-icon>
          <input 
            type="text" 
            placeholder="Buscar por nombre, apellido o correo..." 
            class="search-input"
            [(ngModel)]="busqueda"
            (input)="aplicarFiltros()">
          @if (busqueda) {
            <button class="btn-clear" (click)="busqueda = ''; aplicarFiltros()">
              <lucide-icon name="x"></lucide-icon>
            </button>
          }
        </div>

        <div class="filtros-row">
          <select 
            class="filter-select"
            [(ngModel)]="carreraSeleccionada"
            (change)="aplicarFiltros()">
            <option value="">Todas las carreras</option>
            @for (carrera of carreras; track carrera) {
              <option [value]="carrera">{{ carrera }}</option>
            }
          </select>

          @if (busqueda || carreraSeleccionada) {
            <button class="btn-limpiar" (click)="limpiarFiltros()">
              <lucide-icon name="filter-x"></lucide-icon>
              Limpiar filtros
            </button>
          }

          <div class="resultados-count">
            <lucide-icon name="users"></lucide-icon>
            <span>{{ miembrosFiltrados.length }} resultado(s)</span>
          </div>
        </div>
      </div>
    </div>

    <div class="miembros-grid">
      @for (miembro of miembrosFiltrados; track miembro.id_usuario) {
        <article class="miembro-card">
          <div class="card-header">
            <div class="avatar-section">
              <div class="avatar-placeholder">{{ calcularIniciales(miembro.nombre, miembro.apellido) }}</div>
            </div>
            <div class="info-section">
              <h2 class="nombre">{{ miembro.nombre }} {{ miembro.apellido }}</h2>
              <p class="carrera">{{ miembro.carrera || 'Sin carrera especificada' }}</p>
            </div>
          </div>

          <div class="card-body">
            <div class="contacto-info">
              <div class="contacto-item">
                <lucide-icon name="mail"></lucide-icon>
                <span>{{ miembro.correo }}</span>
              </div>
              @if (miembro.carrera) {
                <div class="contacto-item">
                  <lucide-icon name="graduation-cap"></lucide-icon>
                  <span>{{ miembro.carrera }}</span>
                </div>
              }
            </div>
          </div>
        </article>
      } @empty {
        <div class="empty-state">
          <lucide-icon name="search-x"></lucide-icon>
          @if (busqueda || carreraSeleccionada) {
            <p>No se encontraron miembros con los filtros aplicados</p>
            <button class="btn-limpiar-empty" (click)="limpiarFiltros()">
              Limpiar filtros
            </button>
          } @else {
            <p>No hay miembros registrados aún</p>
          }
        </div>
      }
    </div>
  }
</div>
